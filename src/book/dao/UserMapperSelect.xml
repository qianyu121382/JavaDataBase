<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="book.dao.UseDao">
    <select id="selectAccount" parameterType="book.entity.Account" resultType="book.entity.Account">
        select * from account where userName=#{userName} and password=#{password}
    </select>
    <select id="selectUserId" parameterType="book.entity.Account" resultType="Integer">
        select id from account where userName=#{userName} and password=#{password}
    </select>
    <select id="selectAccountByName" parameterType="String" resultType="book.entity.Account">
        select * from account where userName=#{userName}
    </select>
    <select id="selectRoleByName" parameterType="String" resultType="book.entity.Role">
        select roleName
        from role
                 join userrolemapping on userrolemapping.id = (select id from account where userName = #{userName})
        where userrolemapping.roleId = role.roleId
    </select>
    <select id="selectRolesByName" parameterType="String" resultType="book.entity.Role">
        select roleName
        from role
                 join userrolemapping on userrolemapping.id = (select id from account where userName = #{userName})
        where userrolemapping.roleId = role.roleId
    </select>
    <select id="selectAllRole" resultType="book.entity.Role">
        select * from role
    </select>
    <select id="selectAllUser" resultType="book.entity.UserInfo">
        select * from userinfo
    </select>
    <select id="selectUserInfoById" parameterType="Integer" resultType="book.entity.UserInfo">
        select * from userinfo where id=#{id}
    </select>
    <select id="selectWorkUnitByUnitName" parameterType="String" resultType="book.entity.WorkUnit">
        select * from workunit where unitName=#{unitName}
    </select>
    <select id="selectAllWorkUnit" resultType="book.entity.WorkUnit">
        select * from workunit
    </select>
    <select id="selectBookInfoByName" parameterType="String" resultType="book.entity.BookInfo">
        select * from bookinfo where bookName=#{bookName}
    </select>
    <select id="selectBookInfoById" parameterType="int" resultType="book.entity.BookInfo">
        select * from bookinfo where id=#{id}
    </select>
    <select id="selectBookThroughFilter" parameterType="String" resultType="book.entity.BookInfo">
        select * from bookinfo where bookName like '%${filterTxt}%' or id like '%${filterTxt}%'
                                  or author like '%${filterTxt}%'  or publish like '%${filterTxt}%'
    </select>
    <select id="selectAllBookInfo" resultType="book.entity.BookInfo">
        select * from bookinfo
    </select>
    <select id="selectUnitById" parameterType="int" resultType="book.entity.WorkUnit">
        select * from workunit where id=#{id}
    </select>
    <select id="selectUnitByUserId" parameterType="int" resultType="Integer">
        select unitId from staff
            join userrolemapping on userrolemapping.id=#{id}
                where userrolemapping.roleId=staff.roleId
    </select>
    <select id="selectAllBookInfoByStateAndUnitId" parameterType="book.entity.Turple.UnitIdAndCirculateState" resultType="book.entity.BookInfo">
        select * from bookinfo where circulateState=#{state} and unitId=#{unitId}
    </select>
    <select id="selectUnitIdByUserId" parameterType="Integer" resultType="Integer">
        select unitId from staff
            join userrolemapping on userrolemapping.id=#{id}
            where  userrolemapping.roleId=staff.roleId
    </select>
    <select id="selectUserInfoByUnitId" parameterType="Integer" resultType="book.entity.UserInfo">
        select * from userinfo where unitId=#{unitId}
    </select>
    <select id="selectCirculateByUnitIdState" parameterType="book.entity.Turple.UnitIdCirState" resultType="book.entity.Mapping.Circulate">
        select * from circulate
                where state=#{state} and unitId =#{unitId}
    </select>
    <select id="selectCirculateById" parameterType="Integer" resultType="book.entity.Mapping.Circulate">
        select * from circulate where id=#{id}
    </select>
    <select id="selectBookByCirId" parameterType="Integer" resultType="book.entity.BookInfo">
        select *
        from bookinfo
                 join circulate on circulate.id = #{id}
        where circulate.bookId = bookinfo.id
    </select>
    <select id="selectBookFromCirByUnitIdState" parameterType="book.entity.Turple.UnitIdCirState" resultType="book.entity.Mapping.Circulate">
        select * from circulate
            join bookinfo on bookinfo.unitId=#{unitId}
                where state=#{state} and bookinfo.id=circulate.bookId
    </select>
    <select id="selectBorrowStateById" parameterType="Integer" resultType="book.entity.Mapping.Borrow">
            select * from borrow where id=#{id}
    </select>
    <select id="selectBorrowBookByUserId" parameterType="Integer" resultType="book.entity.Mapping.Borrow">
        select * from borrow where userId=#{userId}
    </select>
    <select id="selectBorrowByBookId" parameterType="Integer" resultType="book.entity.Mapping.Borrow">
        select * from borrow where bookId=#{bookId}
    </select>
    <select id="selectNumBookByUnitId" parameterType="Integer" resultType="Integer">
        select count(*) from bookinfo where unitId=#{unitId}
    </select>
    <select id="selectNumCirByUnitId" parameterType="Integer" resultType="Integer">
        select count(*) from circulate where unitId=#{unitId}
    </select>
    <select id="selectNumBorByUnitId" parameterType="Integer" resultType="Integer">
        select count(*) from borrow where unitId=#{unitId}
    </select>
    <select id="selectNumRoleByUnitId" parameterType="Integer" resultType="Integer">
        select count(*) from staff where unitId=#{unitId}
    </select>
</mapper>